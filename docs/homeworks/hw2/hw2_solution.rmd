---
title: "Решение домашки №2"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    toc_depth: 4
    highlight: pygments
editor_options: 
  chunk_output_type: console
---
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r}
library(readr)
library(dplyr)
```

### Задание 1 (15 баллов)

Есть файлик *random.csv*. Нужно импортировать его в R!:)

```{r}
random <- read_csv2('data/random.csv', 
                    col_names = FALSE, 
                    comment = '#',
                    col_types = cols(X3 = col_double()))
```

или

```{r eval=FALSE}
random <- read_csv2('data/random.csv', 
                    comment = '#', 
                    guess_max = 1510, 
                    col_names = F)
```

### Задание 2 (85 баллов)

#### Набор данных

В наборе данных *nobel.csv* представлена информация об обладателях [нобелевской премии](https://ru.wikipedia.org/wiki/Нобелевская_премия#Правила_премии). Ниже будут перечислены некоторые переменные, которые там есть.

<center>
![](pictures/paint_nobel_prize.png){width=300px}
</center>

* `Year` -- год, в котором была выдана премия
* `Category` -- область, в которой была выдана премия
* `Prize` -- название премии
* `Motivation` -- за что была выдана премия
* `Laureate ID` -- ID лауреата
* `Laureate Type` -- тип награды
* `Full Name` -- полное имя лауреата
* `Birth Date` -- день рождения лауреата
* `Birth City` -- город рождения лауреата
* `Birth Country` -- страна рождения лауреата
* `Sex` -- пол лауреата
* `Organization Name` -- организация, в которой работал лауреат
* `Organization City` -- город, в котором находится организация
* `Organization Country` -- страна, в которой находится организация
* `Death Date` -- дата смерти лауреата
* `Death City` -- город смерти лауреата
* `Death Country` -- страна смерти лауреата

---

#### Задачки

* Подгрузите файлик *nobel.csv*. Набор данных назовите `nobel`. Сколько наблюдений и переменных в этом наборе данных? Давайте выкинем из набора данных переменные, которые находятся в переменной `DROP`. Они нам не понадобятся. (3 баллов)

```{r}
DROP <- c("Prize", "Motivation", "Laureate ID", "Laureate Type", 
          "Organization Name", "Organization City", "Organization Country",
          "Prize Share")
```

```{r}
nobel <- read_csv('data/nobel.csv')
glimpse(nobel)
nobel <- nobel %>% 
          select(-DROP)
```

* За какой период у нас есть данные? (3 баллов)

```{r}
range(nobel$Year)
```

или

```{r}
nobel %>% summarise(min = min(Year),
                    max = max(Year))
```

* В каких областях и сколько раз выдавалась премия? Какая область оказалась самой "старой" и "молодой"? (3 баллов)

```{r}
table(nobel$Category) %>% sort()
```

или

```{r}
nobel %>% 
  count(Category) %>%
  arrange(n)
```

В телеге я написал, что под "старой" имеется ввиду та область, по которой выдавалось больше всего премий. Можно было также найти старую в прямом смысле этого слова. Просто для каждой области найти год, когда она начала выдаваться. Оба варианта считаются правильными.

```{r}
nobel %>% 
  group_by(Category) %>% 
  summarise(min_year = min(Year)) %>%
  arrange(min_year)
```

* Сколько раз премию получили мужчины/женщины? (5 баллов)

```{r}
nobel %>% 
  count(Sex)
```

* Выведите год, область, имя, дату рождения и место рождения всех лауретов, которые родились в России. Сколько таких лауреатов? (5 баллов)

```{r}
nobel %>% 
  filter(`Birth Country` == 'Russia') %>%
  select(Year, Category, `Full Name`, `Birth Date`, `Birth City`)

nobel %>% 
  filter(`Birth Country` == 'Russia') %>% 
  select(Year, Category, `Full Name`, `Birth Date`, `Birth City`) %>% 
  count()
```

Если вы учитывали еще `Russian Empire (Russia)`, то ничего страшного.

* Найдите топ-20 стран в порядке убывания по количеству лауретов, которые родились в этих странах. Какая страна является топ-1? Сколько лауреатов родились в этой стране? (5 баллов)

```{r}
nobel %>%
  count(`Birth Country`, sort = TRUE) %>%
  head(20)
```

или

```{r}
nobel %>% 
  group_by(`Birth Country`) %>% 
  summarise(n = n()) %>% 
  arrange(desc(n)) %>% 
  head(20)
```

* Найдите количество лауреатов, которые родились в Америке, за каждое десятилетие (1900-19009, 1910 - 1919 и так далее). В какое десятилетие было больше всего таких лауреатов? (10 баллов)

```{r}
nobel %>%
  filter(`Birth Country` == 'United States of America') %>%
  mutate(decade = Year - Year%%10) %>%
  count(decade)
```

или

```{r}
nobel %>% 
  mutate(usa_born_winner = `Birth Country` == "United States of America",
         decade = Year - Year%%10) %>%
  group_by(decade) %>%
  summarize(proportion = sum(usa_born_winner, na.rm = TRUE))
```

* Первая женщина, которая получила нобелевскую премию. Кто она, в каком году и в какой области она ее получила? (5 баллов)

```{r}
nobel %>%
  filter(Sex == 'Female') %>%
  select(Year, Category, `Full Name`) %>%
  top_n(1, desc(Year))
```

или

```{r}
nobel %>% 
  filter(Sex == 'Female') %>% 
  select(Year, Category, `Full Name`) %>% 
  head(1)
```

* Найдите людей, которые получали премию больше одного раза. Получал ли кто-то премию 3 раза?  (5 баллов)

```{r}
nobel %>%
  count(`Full Name`, sort = TRUE) %>%
  filter(n>1)

nobel %>% 
  count(`Full Name`, sort = T) %>% 
  filter(n == 3)
```

* В какие года премию получил **Frederick Sanger**? (5 баллов)

```{r}
nobel %>% 
  filter(`Full Name` == 'Frederick Sanger') %>% 
  select(Year) 
```

* Кто был самым молодым и самым старым лауреатом в момент получения премии? Мы только частично изучили с вами пакет `lubridate`. В нем есть функция `year` с помощью которой вы можете вытащить год из даты. (6 баллов)

```{r message=FALSE, warning=FALSE}
library(lubridate)

DATE <- dmy('10/12/2009')
YEAR <- year(DATE)
print(YEAR)
```

```{r}
nobel %>% 
  mutate(age_nobel = Year - year(`Birth Date`)) %>% 
  select(`Full Name`, age_nobel) %>% 
  arrange(age_nobel) %>% 
  head(1)

nobel %>%
  mutate(age_nobel = Year - year(`Birth Date`)) %>% 
  select(`Full Name`, age_nobel) %>% 
  arrange(desc(age_nobel)) %>% 
  head(1)
```

или

```{r}
nobel %>% 
  mutate(age_nobel = Year - year(`Birth Date`)) %>% 
  select(`Full Name`, age_nobel) %>% 
  top_n(1, age_nobel) 

nobel %>%
  mutate(age_nobel = Year - year(`Birth Date`)) %>% 
  select(`Full Name`, age_nobel) %>% 
  top_n(1, desc(age_nobel))
```

* Найти средний возраст лауреатов в годах для каждой области. Вы можете вычитать одну дату из другой и получить разницу между этими датами в днях. Эти дни можно преобразовать к году. Будем считать, что в году всегда 365 дней. Тут может понадобиться функция `as.numeric`. Кто живет дольше всех? (5 баллов)

```{r}
nobel %>%
  mutate(age = as.numeric(`Death Date` - `Birth Date`)/365) %>%
  group_by(Category) %>%
  summarize(Mean_age = mean(age, na.rm = TRUE))
```

* Найти средний возраст лауретов в разрезе область-пол. (6 баллов)

```{r}
nobel %>%
  mutate(age = as.numeric(`Death Date` - `Birth Date`)/365) %>%
  group_by(Category, Sex) %>%
  summarize(Mean_age = mean(age, na.rm = TRUE))
```

* Найдите количество людей, которые родились и умерли в одной стране. Найдите количество людей, которые родились и умерли в одном городе. (6 баллов)

```{r}
nobel %>% 
  filter(`Birth Country` == `Death Country`) %>% 
  count()
```

```{r}
nobel %>% 
  filter(`Birth City` == `Death City`) %>% 
  count()
```

* Найти долю женщин и мужчин получивших премию для каждого десятилетия. (13 баллов)

Функцию `group_by` можно использовать с функцией `mutate`. Например нужно посчитать сумму элементов в каждой группе и проставить это значение каждому наблюдению в группе. 

```{r message=FALSE, warning=FALSE}
library(tibble)
library(dplyr)
df <- tibble(GROUP = rep(c(1,2), each = 3),
             VALUE = seq(10,60, by = 10))
df
df %>%
  group_by(GROUP) %>%
  mutate(SUM = sum(VALUE))
```

```{r}
nobel %>%
  mutate(decade = Year - Year%%10) %>%
  group_by(decade, Sex) %>% 
  summarize(COUNT = n()) %>%
  mutate(All = sum(COUNT),
         PROP = COUNT/All)
```

или

```{r}
nobel %>% 
  mutate(decade = Year - Year%%10) %>%
  filter(Sex == 'Male' | Sex == 'Female') %>%  
  group_by(decade) %>% 
  summarise(Men = mean(Sex == 'Male', na.rm = T),
            Women = mean(Sex == 'Female', na.rm = T))
```


