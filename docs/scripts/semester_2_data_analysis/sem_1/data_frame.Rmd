---
title: "Data frame"
author: "Ахмедушка"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    highlight: pygments
    #df_print: paged
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Ликбез по типам данных 

Перед тем как мы начнем познавать анализ данных, давайте вспомним основные типы данных, которые используются в R:

1. Переменная
2. Массив(вектор)
3. Матрица
4. List
5. Data frame

С переменными и массивами мы работали в 1 семестре, поэтому мы их хорошо усвоили. Про матрицы мы поговорим на факультативе по графам. List иногда бывает полезен, но не будет использоваться в этом курсе. Основным типом данных в нашем курсе будет *data frame* или коротко *df*. Data frame состоит из массивов, а массивы состоят из переменных, поэтому стоит узнать их получше.

## Переменная

Переменная - это самый простой тип данных в R. Вы можете сохранять какое-нибудь значение под определённым названием. Помним, что название должно начинаться с буквы и не содержать пробелов.

Вспомним какие типы переменных бывают в R:

1. Числовой(numeric/integer/double)
2. Строковый(character)
3. Логический(logical)
4. Категориальный или факторный(factor)
5. Дата + время (date)
6. NA(not available)
7. NaN(not a number)

```{r collapse=TRUE}
number <- 5
print(number)
(name <- 'Ahmedushka')
(log <- TRUE)
(factor <- factor("Jan"))
(date <- Sys.Date())
(na <- NA)
(nan <- NaN)
```

Класс переменной всегда можно проверить с помощью функций `class()` и `typeof()`. 

```{r collapse=TRUE}
class(number)
class(name)
class(log)
class(factor)
class(date)
class(na)
class(nan)
```

Также можно воспользоваться семейством функций `is.*`, чтобы узнать принадлежит ли переменная к опреденному типу.

```{r collapse=TRUE}
is.numeric(number)
is.character(name)
is.logical(log)
is.factor(factor)
is.na(na)
```

Про даты и время мы поговорим позже. Вспомним еще семейство функций `as.*`, с помощью которых можно менять тип переменной.

```{r collapse=TRUE}
class(number)
number <- as.character(number)
class(number)
```

## Массив

Массив - это упорядоченный набор значений. Основной тип данных, который используется для создания более сложных типов данных. Следует помнить, что массив может содержать переменные только одного типа. Иначе переменные будут принудительно изменены.

```{r}
numbers <- c(1,4,5,2)
names <- c('Ahmedushka', 'Alex', 'Maksim')
logs <- c(TRUE, FALSE, 1, 0) # логические и числовые типы переменных дружат :3
```

Давайте разбремся зачем нужны факторные переменные. Представьте, что у вас есть массив, в котором записаны названия месяцев. 

```{r}
year1 <- c('Dec', 'Jan', 'Apr', 'Mar')
```

Существует 12 возможных значений. Но при использовании обычного массива у вас возникают 2 проблемы:

1. Возможны опечатки:

```{r}
year2 <- c('Dec', 'Jam', 'Apr', 'Mar')
```

2. Этот список не сортируется так как нам хотелось бы(сортируется в алфавитном порядке):

```{r}
sort(year1)
```

Эти 2 проблемы можно избежать с помощью факторов:

```{r}
months <- c('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec') # задаем порядок и список допустимых значений
year1_2 <- factor(year1, levels = months)
year2_2 <- factor(year2, levels = months)
```

Если мы совершим ошибку, то выставится значение `NA`. А теперь попробуем отсортировать наш фактор.

```{r}
sort(year1_2)
```

## Data Frame

Прежде чем переходить к df, погорим о том, как будут выглядеть для нас данные в этом курсе. Мы будем рассматривать данные "наблюдение - объекты", их обычно используют в машинном обучении, а также в эконометрике(cross-section). В строках у нас находятся наблюдения. А столбцы это объекты или переменные. К примеру данные про группу людей. Каждое наблюдение это человек, а переменные(объекты) это например фамилия, пол, возраст и так далее. К примеру можно рассмотреть табличку снизу. В ней 4 наблюдения и 4 переменные(имя, возраст, пол, дата рождения).

| Имя    |Возраст|   Пол    |Дата рождения|
|:------:|:-----:|---------:|   :------:  | 
|Ахмед   |20     |М         |  5 мая      |
|Виталик |21     |М         |  22 февраля |
|Рита    |20     |Ж         |  20 сентября|
|Даша    |20     |Ж         |  26 ноября  |

Очень важно отметить, что каждая переменная это массив, который имеет определенный тип переменных.

* Имя -- Строковый(character)
* Возраст -- числовой(numeric/integer/double)
* Пол -- факторный(factor)
* Дата рождения -- дата + время (date)

А наблюдения имеют разнородные данные. Именно поэтому мы не можем пользоваться матрицами. Матрицы должны содержать данные одного типа.

Давайте создадим наш первый data frame. Для этого нам нужна функция `data.frame`. Создадим табличку выше.

```{r}
data <- data.frame('Имя' = c('Ахмед', 'Виталик', 'Рита', 'Даша'),
                   'Возраст' = c(20,21,20,20),
                   'Пол' = c('М', 'М', 'Ж', 'Ж'),
                   'Дата рождения' = c('5 мая', '22 февраля', '20 сентября', '26 ноября'))
data
```

Заметим, что название переменной "Дата рождения" изменилось на "Дата.рождения".Это происхоит, потому что data frame запрещает иметь в названии пробелы, а также он запрещает называть переменные с цифр или символов. При создании data frame, мы не делали упор на тип переменных. Мы рассмотрим это позже. Сейчас важно создавать data frame и выполнять с ним основные операции. Чтобы удобно просмотреть, что находится в вашем data frame, можно нажать на него в окошке справа(где находятся все переменные, функции и т.д.) или использовать функцию `View(data)`, где `data` название вашего data frame.

Давайте убедимся, что перед нами правда data frame. Сделаем это с помощью функции `class`.

```{r}
class(data)
```

Когда вы только начинаете работать с каким-то df, лучше сначала использовать функцию `str`. Она даёт некоторую информации о вашем df.

```{r}
str(data)
```

Можно увидеть, что мы имеем дело с df, у которого 4 наблюдения и 4 переменные, а также информацию по каждому столбцу(переменной). После названия столбца(переменной) идет тип переменных в нем. Заметим, что переменные имя, пол и дата рождения имеют факторный тип переменных. Так происходит из-за параметра `stringAsFactors`. Давайте выставим `FALSE` и посмотрим на данные заново.

```{r}
data <- data.frame('Имя' = c('Ахмед', 'Виталик', 'Рита', 'Даша'),
                   'Возраст' = c(20,21,20,20),
                   'Пол' = c('М', 'М', 'Ж', 'Ж'),
                   'Дата рождения' = c('5 мая', '22 февраля', '20 сентября', '26 ноября'),
                   stringsAsFactors = FALSE)
str(data)
```

Теперь наши переменные являются строковыми(character). Пока что не обращаем внимание на то, что пол не имеет факторный тип переменных, а дата рождения не является датой. В R и его пакетах есть встроенные датасеты(df). Давайте воспользуемся датасетом `mtcars`. Об этом датасете можно подробнее прочитать с помощью команды `?mtcars`. Этот датасет о характеристиках машин 1974 года. Для начала изучим структура датасета и найдем его размерность с помощью функции `dim`.

```{r}
str(mtcars)
dim(mtcars)
```

Видим, что имеется 32 наблюдения и 11 переменных, все из которых числовые. Когда df очень большой неудобно просматривать его весь. Обычно смотрят на первые и последние 6 наблюдений с помощью функций `head` и `tail`. Можно выводить не 6 а другое количество наблюдений на экран с помощью парметра `n`.

```{r}
head(mtcars)
tail(mtcars, n = 3)
```

Data frame очень похож на матрицу. Он тоже двумерный, поэтому к нему можно обращаться как к матрице. Давайте найдем значение в 1 строке(наблюдении), во 2 столбце(переменной). Выведем полностью 1 строку(наблюдение) и 3 столбец(переменную).

```{r}
mtcars[1, 2]
mtcars[1, ]
mtcars[, 3]
```

Можно получать срезы. Например мне нужны 1-3 наблюдения и 2-4 переменные.

```{r}
mtcars[1:3,2:4]
```

Чтобы получить полный список названий переменных, можно использовать функцию `names`. На выходе вы получите массив имен.

```{r}
names(mtcars)
```

Переменные можно выбирать и с помощью имени. 

```{r}
mtcars[1:3,"disp"]
```

Или это можно сделать с помощью знака `$`. После него можно нажать кнопку *TAB* и увидеть всевозможнные варианты.

```{r}
mtcars$wt
```

Можно увидеть сводную статистику по каждой переменной с помощью функции `summary`.

```{r}
summary(mtcars)
```

Переменная `cyl` показывает количество цилиндров в машине. Можно увидеть сколько наблюдений приходится на определенное количество цилиндров с помощью функции `table`.

```{r}
table(mtcars$cyl)
```

## Tibble

Функция `data.frame` была придумана 10-20 лет назад. Но мир не стоит на месте. R развивается, многие функции улучшаются и оптимизируются. Сейчас все пользуются функцией `tibble` для создания df. Данная функция находится в одноименном пакете `tibble`. Удалить функцию `data.frame` нельзя, потому что можно поставить работоспособность существующего кода. Я советую пользоваться `tibble`, так как мы будем работать с библиотекой `tidyverse`, в которой все пакеты взаимосвязаны и предназначены для работы с `tibble`. Давайте подгрузим пакет.

```{r}
# install.packages('tibble')
library('tibble')
```

У `tibble` есть красивая справка. Её можно вызвать с помощью команды `vignette('tibble')`. Давайте создадим первый df.

```{r}
df <- tibble(
        x = 1:5,
        y = 1,
        c = 'a', 
        z = x^2 + y,
        `:)` = 10,
        ` ` = NA
      )
df
str(df)
```

Заметим некоторые отличия от функции `data.frame`:

* Можно ссылаться на уже созданные переменные(переменная `z`).
* С помощью ` можно давать любые названия переменным.
* При отображении `tibble` под названиями переменных появляется тип переменных.
* Для удобного отображения появляются только первые 10 наблюдений и все переменные, которые помещаются в пределах экрана.

Также бывает удобным задавать `tibble` в виде таблицы. Для этого можно использовать функцию `tribble`. Давайте попробуем.

```{r}
df1 <- tribble(
        ~x, ~y, ~z,
        #--|--|---
        "a", 2, 3.6,
        "b", 1, 8.5
       )
df1
```

Часто некоторые базовые функции не работают с `tibble` или некоторые функции из пакетов не очень хорошо работают с `data.frame`. В таких случаях вы можете перевести `tibble` в `data.frame` и наоборот с помощью функций `as_tibble` и `as.data.frame`.

```{r}
as_tibble(mtcars)
as.data.frame(df)
```

## Первичная визуализация

Для того, чтобы быстро посмотреть на распределение(гистограмму) какой-то переменной можно использовать функцию `hist`.

```{r}
hist(mtcars$mpg, breaks = 30)
```

Если же вы хотите быстро посомтреть на зависимость одной переменной от другой можно использовать обычную функцию `plot`. 

```{r}
plot(mtcars$disp, mtcars$mpg)
```

Данные рисунки используются для быстрой визуализации. Скоро мы изучим пакет `ggplot2` для более продвинутой и красивой визуализации.

## Изменение типа переменных

Для изменения типа переменных используется семейство функций `as.*`.

* `as.integer`
* `as.numeric`
* `as.character`
* `as.factor`
* `as.Date`
* `as.POSIXct`
* `as.logical`

Работу с датами мы будем обсуждать позже с помощью пакета `lubridate`.

```{r}
df <- tibble(
        x = c('1', '2', '3', '4'),
        y = c(10, 20, 30, 40),
        z = c(1,0,1,0),
        s = c('M','F', 'M', 'F')
      )
df
str(df)
```

```{r}
df$x <- as.numeric(df$x)
df$y <- as.character(df$y)
df$z <- as.logical(df$z)
df$s <- as.factor(df$s)
df
str(df)
```

